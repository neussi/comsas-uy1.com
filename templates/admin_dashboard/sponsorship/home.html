{% extends 'admin_dashboard/base.html' %}
{% load static %}

{% block page_title %}Gestion du Parrainage{% endblock %}
{% block page_icon %}handshake{% endblock %}

{% block content %}
<!-- Header -->
<div class="row mb-4 align-items-center">
    <div class="col-md-6">
        <h4 class="fw-bold mb-0 text-dark">Espace Parrainage</h4>
        <p class="text-muted small mb-0">Pilotez les sessions de mentorat et les binômes</p>
    </div>
    <div class="col-md-6 text-end d-flex justify-content-end gap-2">
        <a href="{% url 'admin_session_create' %}" class="btn btn-success shadow-sm hover-lift text-white">
            <i class="fas fa-plus me-2"></i>Nouvelle Session
        </a>
        <form method="post" action="{% url 'admin_sponsorship_auto_match' %}"
            onsubmit="return confirm('Voulez-vous lancer le matching automatique pour les filleuls sans parrain ?');">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary shadow-sm hover-lift">
                <i class="fas fa-magic me-2"></i>Matching Auto
            </button>
        </form>
    </div>
</div>

<!-- Stats Overview -->
<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="card border-0 shadow-sm p-3 d-flex flex-row align-items-center justify-content-between h-100">
            <div>
                <h6 class="text-muted text-uppercase small fw-bold mb-1">Parrains</h6>
                <h3 class="mb-0 fw-bold text-primary">{{ stats.total_mentors }}</h3>
            </div>
            <div class="bg-primary bg-opacity-10 text-primary rounded-circle p-3">
                <i class="fas fa-chalkboard-teacher fa-lg"></i>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-0 shadow-sm p-3 d-flex flex-row align-items-center justify-content-between h-100">
            <div>
                <h6 class="text-muted text-uppercase small fw-bold mb-1">Filleuls</h6>
                <h3 class="mb-0 fw-bold text-info">{{ stats.total_mentees }}</h3>
            </div>
            <div class="bg-info bg-opacity-10 text-info rounded-circle p-3">
                <i class="fas fa-user-graduate fa-lg"></i>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-0 shadow-sm p-3 d-flex flex-row align-items-center justify-content-between h-100">
            <div>
                <h6 class="text-muted text-uppercase small fw-bold mb-1">Binômes</h6>
                <h3 class="mb-0 fw-bold text-success">{{ stats.active_matches }}</h3>
            </div>
            <div class="bg-success bg-opacity-10 text-success rounded-circle p-3">
                <i class="fas fa-link fa-lg"></i>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-0 shadow-sm p-3 d-flex flex-row align-items-center justify-content-between h-100">
            <div>
                <h6 class="text-muted text-uppercase small fw-bold mb-1">En Attente</h6>
                <h3 class="mb-0 fw-bold text-warning">{{ stats.pending_mentees }}</h3>
            </div>
            <div class="bg-warning bg-opacity-10 text-warning rounded-circle p-3">
                <i class="fas fa-clock fa-lg"></i>
            </div>
        </div>
    </div>
</div>

<!-- Quick Navigation Cards -->
<div class="row g-4 mb-4">
    <div class="col-md-4">
        <a href="{% url 'admin_sponsorship_mentors' %}"
            class="card border-0 shadow-sm h-100 text-decoration-none group hover-shadow transition-all">
            <div class="card-body p-4 d-flex align-items-center">
                <div class="bg-indigo-soft rounded p-3 me-3 text-indigo">
                    <i class="fas fa-users-cog fa-2x text-primary"></i>
                </div>
                <div>
                    <h5 class="fw-bold text-dark mb-1">Gestion des Parrains</h5>
                    <p class="text-muted small mb-0">Consultez et validez les profils des mentors</p>
                </div>
                <div class="ms-auto opacity-0 group-hover:opacity-100 transition-opacity">
                    <i class="fas fa-chevron-right text-muted"></i>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-4">
        <a href="{% url 'admin_sponsorship_mentees' %}"
            class="card border-0 shadow-sm h-100 text-decoration-none group hover-shadow transition-all">
            <div class="card-body p-4 d-flex align-items-center">
                <div class="bg-teal-soft rounded p-3 me-3 text-teal">
                    <i class="fas fa-users fa-2x text-info"></i>
                </div>
                <div>
                    <h5 class="fw-bold text-dark mb-1">Gestion des Filleuls</h5>
                    <p class="text-muted small mb-0">Suivez les étudiants et leurs besoins</p>
                </div>
                <div class="ms-auto opacity-0 group-hover:opacity-100 transition-opacity">
                    <i class="fas fa-chevron-right text-muted"></i>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-4">
        <a href="{% url 'admin_sponsorship_matches' %}"
            class="card border-0 shadow-sm h-100 text-decoration-none group hover-shadow transition-all">
            <div class="card-body p-4 d-flex align-items-center">
                <div class="bg-pink-soft rounded p-3 me-3 text-pink">
                    <i class="fas fa-project-diagram fa-2x text-success"></i>
                </div>
                <div>
                    <h5 class="fw-bold text-dark mb-1">Binômes & Matching</h5>
                    <p class="text-muted small mb-0">Créez et gérez les associations</p>
                </div>
                <div class="ms-auto opacity-0 group-hover:opacity-100 transition-opacity">
                    <i class="fas fa-chevron-right text-muted"></i>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- Sessions List -->
<div class="card border-0 shadow-sm">
    <div class="card-header bg-white border-0 py-4">
        <h5 class="mb-0 fw-bold text-dark">Sessions de Parrainage</h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light text-uppercase text-muted small">
                    <tr>
                        <th class="ps-4 border-0">Session</th>
                        <th class="border-0">Période</th>
                        <th class="border-0">Statut</th>
                        <th class="border-0 text-end pe-4">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for session in sessions %}
                    <tr>
                        <td class="ps-4">
                            <div class="d-flex align-items-center">
                                <div class="bg-light text-primary rounded p-2 me-3">
                                    <i class="fas fa-calendar-check fa-lg"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0 fw-bold text-dark">{{ session.name }}</h6>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="small">
                                <span class="d-block text-dark"><i class="fas fa-play text-success me-2"
                                        style="width: 10px;"></i>{{ session.start_date|date:"d M Y" }}</span>
                                <span class="d-block text-muted mt-1"><i class="fas fa-flag-checkered text-danger me-2"
                                        style="width: 10px;"></i>{{ session.end_date|date:"d M Y" }}</span>
                            </div>
                        </td>
                        <td>
                            {% if session.is_active %}
                            <span class="badge bg-success bg-opacity-10 text-success rounded-pill px-3">En cours</span>
                            {% else %}
                            <span
                                class="badge bg-secondary bg-opacity-10 text-secondary rounded-pill px-3">Terminée</span>
                            {% endif %}
                        </td>
                        <td class="text-end pe-4">
                            <div class="btn-group">
                                <a href="{% url 'admin_session_edit' session.pk %}"
                                    class="btn btn-sm btn-light text-primary rounded-circle me-1" title="Modifier">
                                    <i class="fas fa-pen"></i>
                                </a>
                                <a href="{% url 'admin_session_delete' session.pk %}"
                                    class="btn btn-sm btn-light text-danger rounded-circle" title="Supprimer"
                                    onclick="return confirm('Supprimer cette session ?')">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center py-5">
                            <i class="fas fa-calendar-times fa-3x text-muted mb-3 opacity-50"></i>
                            <p class="text-muted fw-bold mb-1">Aucune session active</p>
                            <p class="text-muted small">Créez une session pour démarrer le parrainage.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .hover-lift:hover {
        transform: translateY(-2px);
    }

    .group:hover .group-hover\:opacity-100 {
        opacity: 1 !important;
    }
</style>
{% endblock %}